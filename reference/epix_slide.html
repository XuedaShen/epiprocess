<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Slides a given function over variables in an epi_archive object. This
behaves similarly to epi_slide(), with the key exception that it is
version-aware: the sliding computation at any given reference time t is
performed on data that would have been available as of t. See the
archive vignette for
examples."><title>Slide a function over variables in an epi_archive object — epix_slide • epiprocess</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Slide a function over variables in an epi_archive object — epix_slide"><meta property="og:description" content="Slides a given function over variables in an epi_archive object. This
behaves similarly to epi_slide(), with the key exception that it is
version-aware: the sliding computation at any given reference time t is
performed on data that would have been available as of t. See the
archive vignette for
examples."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9999</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/epiprocess.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/slide.html">Slide a computation over signal values</a>
    <a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a>
    <a class="dropdown-item" href="../articles/correlation.html">Correlate signals over space and time</a>
    <a class="dropdown-item" href="../articles/aggregation.html">Aggregate signals over space and time</a>
    <a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a>
    <a class="dropdown-item" href="../articles/archive.html">Work with archive objects and data revisions</a>
    <a class="dropdown-item" href="../articles/advanced.html">Advanced sliding with nonstandard outputs</a>
    <a class="dropdown-item" href="../articles/compactify.html">Compactify to remove redundant archive data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/tree/main/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Slide a function over variables in an <code>epi_archive</code> object</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/main/R/methods-epi_archive.R" class="external-link"><code>R/methods-epi_archive.R</code></a></small>
      <div class="d-none name"><code>epix_slide.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Slides a given function over variables in an <code>epi_archive</code> object. This
behaves similarly to <code><a href="epi_slide.html">epi_slide()</a></code>, with the key exception that it is
version-aware: the sliding computation at any given reference time t is
performed on <strong>data that would have been available as of t</strong>. See the
<a href="https://cmu-delphi.github.io/epiprocess/articles/archive.html">archive vignette</a> for
examples.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">epix_slide</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">f</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">group_by</span>,</span>
<span>  <span class="va">ref_time_values</span>,</span>
<span>  <span class="va">time_step</span>,</span>
<span>  new_col_name <span class="op">=</span> <span class="st">"slide_value"</span>,</span>
<span>  as_list_col <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  names_sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>  all_rows <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>An <code>epi_archive</code> object.</p></dd>


<dt>f</dt>
<dd><p>Function or formula to slide over variables in <code>x</code>. To "slide" means
to apply a function or formula over a running window of <code>n</code> time steps
(where one time step is typically one day or one week). If a function, <code>f</code>
must take <code>x</code>, a data frame with the same column names as the original
object; followed by any number of named arguments; and ending with
<code>...</code>. If a formula, <code>f</code> can operate directly on columns accessed via
<code>.x$var</code>, as in <code>~ mean(.x$var)</code> to compute a mean of a column <code>var</code> over a
sliding window of <code>n</code> time steps.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments to pass to the function or formula specified
via <code>f</code>. Alternatively, if <code>f</code> is missing, then the current argument is
interpreted as an expression for tidy evaluation.</p></dd>


<dt>n</dt>
<dd><p>Number of time steps to use in the running window. For example, if
<code>n = 7</code>, and one time step is one day, then to produce a value on January 7
we apply the given function or formula to data in between January 1 and
7.</p></dd>


<dt>group_by</dt>
<dd><p>The variable(s) to group by before slide computation. If
missing, then the keys in the underlying data table, excluding <code>time_value</code>
and <code>version</code>, will be used for grouping. To omit a grouping entirely, use
<code>group_by = NULL</code>.</p></dd>


<dt>ref_time_values</dt>
<dd><p>Time values for sliding computations, meaning, each
element of this vector serves as the reference time point for one sliding
window. If missing, then this will be set to all unique time values in the
underlying data table, by default.</p></dd>


<dt>time_step</dt>
<dd><p>Optional function used to define the meaning of one time
step, which if specified, overrides the default choice based on the
<code>time_value</code> column. This function must take a positive integer and return
an object of class <code><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">lubridate::period</a></code>. For example, we can use <code>time_step = lubridate::hours</code> in order to set the time step to be one hour (this
would only be meaningful if <code>time_value</code> is of class <code>POSIXct</code>).</p></dd>


<dt>new_col_name</dt>
<dd><p>String indicating the name of the new column that will
contain the derivative values. Default is "slide_value"; note that setting
<code>new_col_name</code> equal to an existing column name will overwrite this column.</p></dd>


<dt>as_list_col</dt>
<dd><p>If the computations return data frames, should the slide
result hold these in a single list column or try to unnest them? Default is
<code>FALSE</code>, in which case a list object returned by <code>f</code> would be unnested
(using <code><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">tidyr::unnest()</a></code>), and the names of the resulting columns are given
by prepending <code>new_col_name</code> to the names of the list elements.</p></dd>


<dt>names_sep</dt>
<dd><p>String specifying the separator to use in <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">tidyr::unnest()</a></code>
when <code>as_list_col = FALSE</code>. Default is "_". Using <code>NULL</code> drops the prefix
from <code>new_col_name</code> entirely.</p></dd>


<dt>all_rows</dt>
<dd><p>If <code>all_rows = TRUE</code>, then the output will have one row per
combination of grouping variables and unique time values in the underlying
data table. Otherwise, there will be one row in the output for each time
value in <code>x</code> that acts as a reference time value. Default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble whose columns are: the grouping variables, <code>time_value</code>,
containing the reference time values for the slide computation, and a
column named according to the <code>new_col_name</code> argument, containing the slide
values.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Two key distinctions between inputs to the current function and
<code><a href="epi_slide.html">epi_slide()</a></code>:</p><ol><li><p><code>epix_slide()</code> uses windows that are <strong>always right-aligned</strong> (in
<code><a href="epi_slide.html">epi_slide()</a></code>, custom alignments could be specified using the <code>align</code> or
<code>before</code> arguments).</p></li>
<li><p><code>epix_slide()</code> uses a <code>group_by</code> to specify the grouping upfront (in
<code><a href="epi_slide.html">epi_slide()</a></code>, this would be accomplished by a preceding function call to
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code>).
Apart from this, the interfaces between <code>epix_slide()</code> and <code><a href="epi_slide.html">epi_slide()</a></code> are
the same.</p></li>
</ol><p>Note that the outputs are a similar but different: <code>epix_slide()</code> only
returns the grouping variables, <code>time_value</code>, and the new columns from
sliding, whereas <code><a href="epi_slide.html">epi_slide()</a></code> returns all original variables plus the new
columns from sliding.</p>
<p>Furthermore, the current function can be considerably slower than
<code><a href="epi_slide.html">epi_slide()</a></code>, for two reasons: (1) it must repeatedly fetch
properly-versioned snapshots from the data archive (via its <code>as_of()</code>
method), and (2) it performs a "manual" sliding of sorts, and does not
benefit from the highly efficient <code>slider</code> package. For this reason, it
should never be used in place of <code><a href="epi_slide.html">epi_slide()</a></code>, and only used when
version-aware sliding is necessary (as it its purpose).</p>
<p>Finally, this is simply a wrapper around the <code>slide()</code> method of the
<code>epi_archive</code> class, so if <code>x</code> is an <code>epi_archive</code> object, then:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">epix_slide</span>(x, <span class="at">new_var =</span> <span class="fu">comp</span>(old_var), <span class="at">n =</span> <span class="dv">120</span>)</span></code></pre><p></p></div>
<p>is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span><span class="fu">slide</span>(x, <span class="at">new_var =</span> <span class="fu">comp</span>(old_var), <span class="at">n =</span> <span class="dv">120</span>)</span></code></pre><p></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># these dates are reference time points for the 3 day average sliding window</span></span></span>
<span class="r-in"><span><span class="co"># The resulting epi_archive ends up including data averaged from:</span></span></span>
<span class="r-in"><span><span class="co"># 0 day which has no results, for 2020-06-01</span></span></span>
<span class="r-in"><span><span class="co"># 1 day, for 2020-06-02</span></span></span>
<span class="r-in"><span><span class="co"># 2 days, for the rest of the results</span></span></span>
<span class="r-in"><span><span class="co"># never 3 days dur to data latency</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">time_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-15"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      by <span class="op">=</span> <span class="st">"1 day"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">epix_slide</span><span class="op">(</span>x <span class="op">=</span> <span class="va">archive_cases_dv_subset</span>,</span></span>
<span class="r-in"><span>           f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">case_rate_7d_av</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           n <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>           group_by <span class="op">=</span> <span class="va">geo_value</span>,</span></span>
<span class="r-in"><span>           ref_time_values <span class="op">=</span> <span class="va">time_values</span>,</span></span>
<span class="r-in"><span>           new_col_name <span class="op">=</span> <span class="st">'case_rate_3d_av'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `epi_df` object, 56 x 3 with metadata:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * geo_type  = state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * time_type = day</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * as_of     = 2020-06-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 56 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    geo_value time_value case_rate_3d_av</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> ca        2020-06-02            6.63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> fl        2020-06-02            3.38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> ny        2020-06-02            6.57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> tx        2020-06-02            4.52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> ca        2020-06-03            6.54</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> fl        2020-06-03            3.42</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> ny        2020-06-03            6.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> tx        2020-06-03            4.75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> ca        2020-06-04            6.53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> fl        2020-06-04            3.77</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 46 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Logan Brooks, Daniel McDonald, Evan Ray, Ryan Tibshirani.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

