<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4. Correlate signals over space and time • epitools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="4. Correlate signals over space and time">
<meta property="og:description" content="epitools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epitools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/epitools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/slide.html">1. Slide a computation over signal values</a>
    </li>
    <li>
      <a href="../articles/pct-change.html">2. Compute percentage change over time</a>
    </li>
    <li>
      <a href="../articles/derivative.html">3. Estimate derivatives of signals</a>
    </li>
    <li>
      <a href="../articles/correlation.html">4. Correlate signals over space and time</a>
    </li>
    <li>
      <a href="../articles/aggregation.html">5. Aggregate signals over space and time</a>
    </li>
    <li>
      <a href="../articles/issues.html">6. Work with issue dates and archive objects</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cmu-delphi/epitools/tree/main/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="correlation_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>4. Correlate signals over space and time</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epitools/blob/main/vignettes/correlation.Rmd"><code>vignettes/correlation.Rmd</code></a></small>
      <div class="hidden name"><code>correlation.Rmd</code></div>

    </div>

    
    
<p>The <code>epitools</code> package provides some simple functionality for computing lagged correlations between two signals, over space or time, via <code><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged()</a></code>. This function is really just a convenience wrapper over some basic commands: it first performs any specified time shifts, grouped by geo value (this way, it shifts each of the individual time series); then, it removes the geo grouping and applies the grouping that is specified; finally, it computes correlations.</p>
<p>In this vignette, we’ll examine correlations between state-level COVID-19 case and death rates, smoothed using a 7-day trailing average.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">covidcast</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">epitools</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="no">start_day</span> <span class="kw">&lt;-</span> <span class="st">"2020-03-01"</span>
<span class="no">end_day</span> <span class="kw">&lt;-</span> <span class="st">"2021-10-11"</span>

<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/covidcast/man/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                      <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"confirmed_incidence_prop"</span>,
                      <span class="kw">start_day</span> <span class="kw">=</span> <span class="no">start_day</span>,
                      <span class="kw">end_day</span> <span class="kw">=</span> <span class="no">end_day</span>,
                      <span class="kw">geo_type</span> <span class="kw">=</span> <span class="st">"state"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">case_rates</span> <span class="kw">=</span> <span class="no">value</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">geo_value</span>, <span class="no">time_value</span>, <span class="no">case_rates</span>)

<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/covidcast/man/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                      <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"deaths_incidence_prop"</span>,
                      <span class="kw">start_day</span> <span class="kw">=</span> <span class="no">start_day</span>,
                      <span class="kw">end_day</span> <span class="kw">=</span> <span class="no">end_day</span>,
                      <span class="kw">geo_type</span> <span class="kw">=</span> <span class="st">"state"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">death_rates</span> <span class="kw">=</span> <span class="no">value</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">geo_value</span>, <span class="no">time_value</span>, <span class="no">death_rates</span>)

<span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">x</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">y</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"geo_value"</span>, <span class="st">"time_value"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/as.epi_tibble.html">as.epi_tibble</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">geo_value</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span>(<span class="kw">slide_fun</span> <span class="kw">=</span> ~ <span class="fu"><a href="../reference/Min.html">Mean</a></span>(<span class="no">.x</span>$<span class="no">case_rates</span>), <span class="kw">n</span> <span class="kw">=</span> <span class="fl">7</span>,
            <span class="kw">new_col_name</span> <span class="kw">=</span> <span class="st">"case_rates"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span>(<span class="kw">slide_fun</span> <span class="kw">=</span> ~ <span class="fu"><a href="../reference/Min.html">Mean</a></span>(<span class="no">.x</span>$<span class="no">death_rates</span>), <span class="kw">n</span> <span class="kw">=</span> <span class="fl">7</span>,
            <span class="kw">new_col_name</span> <span class="kw">=</span> <span class="st">"death_rates"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()</pre></body></html></div>
<div id="correlations-grouped-by-time" class="section level2">
<h2 class="hasAnchor">
<a href="#correlations-grouped-by-time" class="anchor"></a>Correlations grouped by time</h2>
<p>The <code><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged()</a></code> function operates on an <code>epi_tibble</code> object, and it requires further specification of the variables to correlate, in its next two arguments (<code>var1</code> and <code>var2</code>).</p>
<p>In general, we can specify any grouping variable (or combination of variables) in a call to <code><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged()</a></code>, via the <code>by</code> argument. This potentially leads to many ways to compute correlations. There are always at least two ways to compute correlations in an <code>epi_tibble</code>: grouping by time value, and by geo value. The former is obtained by setting <code>by = time_value</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())

<span class="no">z1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged</a></span>(<span class="no">x</span>, <span class="no">case_rates</span>, <span class="no">death_rates</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">time_value</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">z1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time_value</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">cor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span>(<span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="st">"month"</span>, <span class="kw">date_labels</span> <span class="kw">=</span> <span class="st">"%b %y"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Date"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Correlation"</span>)</pre></body></html></div>
<p><img src="correlation_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The above plot addresses the question: “on any given day, are case and death rates linearly associated, across the U.S. states?”. We might be interested in broadening this question, instead asking: “on any given day, do higher case rates tend to associate with higher death rates?”, removing the dependence on a linear relationship. The latter can be addressed using Spearman correlation, accomplished by setting <code>method = "spearman"</code> in the call to <code><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged()</a></code>. Spearman correlation is highly robust and invariant to monotone transformations.</p>
</div>
<div id="lagged-correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#lagged-correlations" class="anchor"></a>Lagged correlations</h2>
<p>We might also be interested in how case rates associate with death rates in the <em>future</em>. Using the <code>dt1</code> parameter in <code><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged()</a></code>, we can lag case rates back any number of days we want, before calculating correlations. Below, we set <code>dt1 = -10</code>. This means that <code>var1 = case_rates</code> will be lagged by 10 days, so that case rates on June 1st will be correlated with death rates on June 11th. (It might also help to think of it this way: death rates on a certain day will be correlated with case rates at an offset of -10 days.)</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">z2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged</a></span>(<span class="no">x</span>, <span class="no">case_rates</span>, <span class="no">death_rates</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">time_value</span>, <span class="kw">dt1</span> <span class="kw">=</span> -<span class="fl">10</span>)

<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">z1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="fl">0</span>),
           <span class="no">z2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="fl">10</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">lag</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">z</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time_value</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">cor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">lag</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span>(<span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="st">"month"</span>, <span class="kw">date_labels</span> <span class="kw">=</span> <span class="st">"%b %y"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Date"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Correlation"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"Lag"</span>)</pre></body></html></div>
<p><img src="correlation_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can see that, generally, lagging the case rates back by 10 days improves the correlations, confirming case rates are better correlated with death rates 10 days from now.</p>
</div>
<div id="correlations-grouped-by-state" class="section level2">
<h2 class="hasAnchor">
<a href="#correlations-grouped-by-state" class="anchor"></a>Correlations grouped by state</h2>
<p>The second option we have is to group by geo value, obtained by setting <code>by =  geo_value</code>. We’ll again look at correlations both for 0- and 10-day lagged case<br>
rates.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">z1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged</a></span>(<span class="no">x</span>, <span class="no">case_rates</span>, <span class="no">death_rates</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">geo_value</span>)
<span class="no">z2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged</a></span>(<span class="no">x</span>, <span class="no">case_rates</span>, <span class="no">death_rates</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">geo_value</span>, <span class="kw">dt1</span> <span class="kw">=</span> -<span class="fl">10</span>)

<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">z1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="fl">0</span>),
           <span class="no">z2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="fl">10</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">lag</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">z</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">cor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">lag</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">lag</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Correlation"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Density"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"Lag"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"Lag"</span>)</pre></body></html></div>
<p><img src="correlation_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can again see that, generally speaking, lagging the case rates back by 10 days improves the correlations.</p>
</div>
<div id="more-systematic-lag-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#more-systematic-lag-analysis" class="anchor"></a>More systematic lag analysis</h2>
<p>Next we perform a more systematic investigation of the correlations over a broad range of lag values.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>)
<span class="no">lags</span> <span class="kw">=</span> <span class="fl">0</span>:<span class="fl">35</span>

<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(<span class="no">lags</span>, <span class="kw">function</span>(<span class="no">lag</span>) {
  <span class="fu"><a href="https://rdrr.io/pkg/epitools/man/cor_lagged.html">cor_lagged</a></span>(<span class="no">x</span>, <span class="no">case_rates</span>, <span class="no">death_rates</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">geo_value</span>, <span class="kw">dt1</span> <span class="kw">=</span> -<span class="no">lag</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lag</span> <span class="kw">=</span> <span class="no">lag</span>)
  })

<span class="no">z</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">lag</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="../reference/Min.html">Mean</a></span>(<span class="no">cor</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">lag</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mean</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Lag"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Mean correlation"</span>)</pre></body></html></div>
<p><img src="correlation_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We can see that some pretty clear curvature here in the mean correlation between case and death rates (where the correlations come from grouping by geo value) as a function of lag. The maximum occurs at a lag of somewhere around 17 days.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
