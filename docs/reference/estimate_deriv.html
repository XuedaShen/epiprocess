<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Estimate derivative — estimate_deriv • epiprocess</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate derivative — estimate_deriv"><meta property="og:description" content="Estimates the derivative at the end of a sequence of values, using linear
regression, a smoothing spline, or trend filtering. This is a convenience
function to be used inside of a call to epi_slide(), see the estimating derivatives vignette
for examples."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epiprocess</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/epiprocess.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/slide.html">1. Slide a computation over signal values</a>
    </li>
    <li>
      <a href="../articles/pct_change.html">2. Compute percentage change over time</a>
    </li>
    <li>
      <a href="../articles/derivative.html">3. Estimate derivatives of signals</a>
    </li>
    <li>
      <a href="../articles/correlation.html">4. Correlate signals over space and time</a>
    </li>
    <li>
      <a href="../articles/aggregation.html">5. Aggregate signals over space and time</a>
    </li>
    <li>
      <a href="../articles/outliers.html">6. Detect and correct outliers in signals</a>
    </li>
    <li>
      <a href="../articles/issues.html">7. Work with issue dates and archive objects</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/cmu-delphi/epiprocess/tree/main/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate derivative</h1>
    <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/main/R/derivative.R" class="external-link"><code>R/derivative.R</code></a></small>
    <div class="hidden name"><code>estimate_deriv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimates the derivative at the end of a sequence of values, using linear
regression, a smoothing spline, or trend filtering. This is a convenience
function to be used inside of a call to <code><a href="epi_slide.html">epi_slide()</a></code>, see the <a href="https://cmu-delphi.github.io/epiprocess/articles/derivative.html" class="external-link">estimating derivatives vignette</a>
for examples.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">estimate_deriv</span><span class="op">(</span>
  <span class="va">var</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lin"</span>, <span class="st">"ss"</span>, <span class="st">"tf"</span><span class="op">)</span>,
  deriv <span class="op">=</span> <span class="fl">1</span>,
  na_rm <span class="op">=</span> <span class="cn">FALSE</span>,
  keep_obj <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>var</dt>
<dd><p>The variable whose derivative is to be estimated.</p></dd>
<dt>method</dt>
<dd><p>One of "lin", "ss", or "tf" indicating the method to use for
the derivative calculation. We run the given method using <code>var</code> as the
response variable, assuming an equally-spaced sequence of design points,
and return the corresponding estimated derivative (that is, the derivative
of the underlying estimated function, linear or spline) at the end of the
sequence. Default is "lin". See details for more explanation.</p></dd>
<dt>deriv</dt>
<dd><p>Order of derivative to estimate. Only orders 1 or 2 are
supported, with the default being 1. (In some cases, a second-order
derivative will return a trivial result; for example: when <code>method</code> is
"lin", this will always be zero.)</p></dd>
<dt>na_rm</dt>
<dd><p>Should missing values be removed before the computation? Default
is <code>FALSE</code>.</p></dd>
<dt>keep_obj</dt>
<dd><p>Should the fitted object (from linear regression, smoothing
spline, or trend filtering) be returned, along with the estimated
derivative, in a list? This is typically to perform some kind of post hoc
inspection. Default is <code>FALSE</code>.</p></dd>
<dt>...</dt>
<dd><p>Additional arguments to pass to the method used to estimate the
derivative. See details below.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The derivative is estimated using:</p>
<ul><li><p>Linear regression, when <code>method</code> is "lin", via <code><a href="https://rdrr.io/r/stats/lsfit.html" class="external-link">stats::lsfit()</a></code>.</p></li>
<li><p>Cubic smoothing spline, when <code>method</code> is "ss", via
<code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">stats::smooth.spline()</a></code>.</p></li>
<li><p>Polynomial trend filtering, when <code>method</code> is "tf", via
<code><a href="https://rdrr.io/pkg/genlasso/man/trendfilter.html" class="external-link">genlasso::trendfilter()</a></code>.</p></li>
</ul><p>The second and third cases base the derivative calculation on a nonparametric
fit and should typically be used with a larger window <code>n</code> in a parent call
to <code><a href="epi_slide.html">epi_slide()</a></code>. The third case (trend filtering) is more locally adaptive
than the second (smoothing spline) and can work better when there are sharp
changes in the smoothness of the underlying values.</p>
<p>In the first and second cases (linear regression and smoothing spline), the
additional arguments in <code>...</code> are directly passed to the underlying
estimation function (<code><a href="https://rdrr.io/r/stats/lsfit.html" class="external-link">stats::lsfit()</a></code> and <code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">stats::smooth.spline()</a></code>).</p>
<p>The third case (trend filtering) works a little differently: here, a custom
set of arguments is allowed (and are internally distributed as appropriate
to the functions <code><a href="https://rdrr.io/pkg/genlasso/man/trendfilter.html" class="external-link">genlasso::trendfilter()</a></code>, <code><a href="https://rdrr.io/pkg/genlasso/man/cv.trendfilter.html" class="external-link">genlasso::cv.trendfilter()</a></code>,
and <code><a href="https://rdrr.io/pkg/genlasso/man/coef.genlasso.html" class="external-link">genlasso::coef.genlasso()</a></code>):</p>
<dl><dt><code>ord</code></dt>
<dd><p>Order of piecewise polynomial for the trend filtering fit,
default is 2.</p></dd>

<dt><code>maxsteps</code></dt>
<dd><p>Maximum number of steps to take in the solution path before
terminating, default is 100.</p></dd>

<dt><code>cv</code></dt>
<dd><p>Boolean indicating whether cross-validation should be used to
choose an effective degrees of freedom for the fit, default is <code>FALSE</code>.</p></dd>

<dt><code>k</code></dt>
<dd><p>Number of folds if cross-validation is to be used. Default is 5.</p></dd>

<dt><code>df</code></dt>
<dd><p>Desired effective degrees of freedom for the trend filtering
fit. If <code>cv = FALSE</code>, then <code>df</code> must be an integer; if <code>cv = TRUE</code>, then
<code>df</code> should be one of "min" or "1se" indicating the selection rule to use
based on the cross-validation error curve (minimum or 1-standard-error
rule, respectively). Default is 8 when <code>cv = FALSE</code>, and "1se" when <code>cv = TRUE</code>.</p></dd>


</dl></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Evan Ray, Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

